# 租号酷系统架构文档

> 基于 PlantUML 的"4+1"视图架构文档

## 文档说明

本文档使用 PlantUML 工具生成系统架构图，采用经典的"4+1"视图模型描述系统架构：

1. **逻辑视图** - 系统功能分解和模块组织
2. **开发视图** - 代码组织和分层架构
3. **进程视图** - 系统运行时行为和交互
4. **物理视图** - 系统部署和网络拓扑
5. **场景视图** - 用户用例和核心业务流程

## 文件列表

### 1. 逻辑视图
- `01-logical-view.puml` - 系统包图，展示模块划分和依赖关系
- `09-logical-view-class.puml` - 核心类图，展示主要类和关系

### 2. 开发视图
- `02-development-view.puml` - 分层架构图，展示表现层→业务层→数据层的结构

### 3. 进程视图
- `03-process-view.puml` - 用户登录时序图
- `04-process-view-order.puml` - 创建订单时序图

### 4. 物理视图
- `05-physical-view.puml` - 部署架构图，展示服务器和组件部署
- `08-network-topology.puml` - 网络拓扑图，展示等保三级网络架构

### 5. 场景视图
- `06-scenario-view-usecase.puml` - 用例图，展示系统功能用例
- `07-scenario-view-sequence.puml` - 核心业务时序图（租号流程）

### 6. 补充视图
- `10-data-flow.puml` - 数据流图，展示数据在系统中的流转过程
- `11-security-architecture.puml` - 安全架构图，展示加密方式、安全策略和安全组件

## 生成图表

### 方法1：使用自动生成脚本（推荐）✅

项目已提供自动生成脚本，一键生成所有图表：

```bash
cd /home/shigure/zuhaoku/docs/architecture
./generate-diagrams.sh
```

脚本会自动：
- 生成 PNG 格式图表（位图，适合预览）
- 生成 SVG 格式图表（矢量图，适合文档）
- 显示生成的文件列表和大小

### 方法2：使用 PlantUML JAR 文件

```bash
cd /home/shigure/zuhaoku/docs/architecture
# 生成 PNG 格式（支持中文，使用 UTF-8）
java -jar ../../plantuml/plantuml.jar -tpng -charset UTF-8 *.puml

# 生成 SVG 格式（推荐，矢量图，中文支持更好）
java -jar ../../plantuml/plantuml.jar -tsvg -charset UTF-8 *.puml

# 生成单个文件
java -jar ../../plantuml/plantuml.jar -tpng -charset UTF-8 01-logical-view.puml
```

**注意**：如果 PNG 格式中文显示有问题，建议使用 SVG 格式，矢量图对中文支持更好。

### 方法3：使用系统 PlantUML 命令

如果系统已安装 PlantUML：

```bash
cd /home/shigure/zuhaoku/docs/architecture
plantuml -tpng *.puml
plantuml -tsvg *.puml
```

### 方法4：使用在线 PlantUML 服务器

访问 http://www.plantuml.com/plantuml/uml/ 并粘贴 `.puml` 文件内容

### 方法5：使用 VS Code 插件

安装 PlantUML 插件，直接在编辑器中预览和导出

## 架构说明

### 系统架构概述

租号酷系统采用前后端分离的单体架构，主要特点：

- **前端**：Vue3 + TypeScript + Element Plus
- **后端**：Node.js + Express
- **数据库**：MySQL 8.0（TDE 透明加密）
- **部署**：Docker 容器化，单服务部署

### 安全架构

系统实现了等保三级核心安全功能：

1. **身份鉴别**：JWT 认证、登录失败锁定、图形验证码
2. **访问控制**：RBAC 角色模型、接口级权限控制
3. **数据安全**：AES-256-GCM 加密、前端脱敏、TDE 透明加密
4. **密码管理**：Argon2id 加密、密钥环境变量管理
5. **日志审计**：关键操作自动记录、6个月保留策略
6. **业务安全**：令牌桶限流、幂等性检查
7. **隐私保护**：个人信息管理、账号注销、埋点匿名化
8. **监控告警**：健康检查、日志监控、异常告警

### 网络架构

系统采用等保三级要求的网络架构：

- **DMZ 区域**：Web 服务器（Nginx），仅开放 443/80 端口
- **应用服务器区域**：Node.js 应用服务器，内网访问
- **数据库服务器区域**：MySQL 数据库，拒绝公网访问
- **管理区域**：SSL-VPN 网关、堡垒机，独立网段
- **监控区域**：健康检查、日志服务器、告警服务

### 数据流

1. **用户请求**：浏览器 → Nginx → Express → 业务逻辑 → 数据库
2. **安全验证**：请求经过认证、授权、限流、审计等中间件
3. **数据加密**：敏感数据 AES-256-GCM 加密存储，TDE 透明加密
4. **日志记录**：关键操作自动记录审计日志
5. **监控告警**：系统状态实时监控，异常自动告警

## 视图说明

### 逻辑视图
- **包图**：展示系统的模块划分，包括前端表现层、API接口层、业务逻辑层、安全中间件层、数据访问层、工具服务层和数据存储层
- **类图**：展示核心类的结构和关系，包括路由层、中间件层、业务逻辑层、数据访问层和工具服务层的主要类

### 开发视图
- **分层架构**：展示从表现层到数据存储层的完整技术栈，包括 Vue3、Express、MySQL 等组件

### 进程视图
- **登录时序图**：展示用户登录的完整流程，包括验证码、登录锁定、密码验证等安全机制
- **订单时序图**：展示创建订单的流程，包括限流、幂等性检查、支付等环节

### 物理视图
- **部署架构图**：展示系统的物理部署结构，包括 Web 服务器、应用服务器、数据库服务器等
- **网络拓扑图**：展示等保三级要求的网络架构，包括 DMZ 区域、应用服务器区域、数据库服务器区域等
- **安全架构图**：展示系统的安全架构，包括传输层安全、身份鉴别、访问控制、数据安全、密码管理、审计日志、业务安全、安全防护组件、监控告警和隐私保护等

### 场景视图
- **用例图**：展示系统的主要功能用例，包括用户管理、账号管理、订单管理、申诉管理等
- **业务时序图**：展示核心业务流程（租号流程）的完整时序，包括浏览账号、创建订单、支付、获取账号等

### 补充视图
- **数据流图**：展示数据在系统中的流转过程，包括加密、解密、脱敏等安全处理
- **安全架构图**：展示系统的安全架构，包括传输层安全、身份鉴别、访问控制、数据安全、密码管理、审计日志、业务安全、安全防护组件、监控告警和隐私保护等

## 更新日志

- **2025-12-08**：创建完整的"4+1"视图架构文档，包含11个 PlantUML 文件
- **2025-12-10**：新增安全架构图，展示系统的加密方式、安全策略和安全组件

## 参考文档

- [PROJECT_STATUS.md](../PROJECT_STATUS.md) - 项目完成度评估
- [EASY_IMPLEMENTATIONS.md](../EASY_IMPLEMENTATIONS.md) - 功能实现详情
- [TDE_AND_BACKUP.md](../TDE_AND_BACKUP.md) - 数据加密和备份配置
- [shigure.md](../shigure.md) - 等保三级要求

