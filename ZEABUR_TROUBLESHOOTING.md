# Zeabur 部署故障排查指南

## Pod 未触发扩容问题

### 问题描述
```
[Zeabur] Pod/service-xxx - NotTriggerScaleUp: pod didn't trigger scale-up
```

### 可能原因

1. **资源请求过高**
   - Pod 请求的资源超过了集群可用资源
   - 检查 `zeabur.yaml` 中的 `resources.requests` 配置

2. **健康检查失败**
   - 应用启动时间过长，健康检查超时
   - 检查 `/health` 端点是否正常响应

3. **内存/CPU 限制过严**
   - 应用实际需要的资源超过配置的限制
   - 查看应用日志中的 OOM 或 CPU throttling 错误

4. **集群资源不足**
   - Zeabur 集群当前没有足够的资源
   - 需要升级计划或等待资源释放

### 解决方案

#### 1. 优化资源配置

更新 `zeabur.yaml`：

```yaml
resources:
  requests:
    memory: "512Mi"  # 降低初始请求
    cpu: "250m"      # 降低 CPU 请求
  limits:
    memory: "2Gi"    # 设置合理的上限
    cpu: "1000m"
```

#### 2. 优化健康检查

确保应用有健康检查端点：

```yaml
healthcheck:
  path: /health
  interval: 30
  timeout: 10
  retries: 3
  startPeriod: 60  # 给应用足够的启动时间
```

#### 3. 检查应用启动时间

- 查看构建日志，确认应用是否正常启动
- 检查是否有数据库连接超时等问题
- 优化应用启动速度（减少不必要的初始化）

#### 4. 查看详细日志

在 Zeabur 控制台：
1. 进入服务详情页
2. 查看 "Logs" 标签页
3. 查找错误信息（OOM、连接失败等）

#### 5. 临时解决方案

如果问题持续，可以尝试：
- 手动重启服务
- 检查环境变量配置是否正确
- 确认数据库连接是否正常

### 常见错误及解决

#### 错误：Out of Memory (OOM)
```
解决方案：
1. 增加 memory limits
2. 优化应用内存使用
3. 检查是否有内存泄漏
```

#### 错误：健康检查失败
```
解决方案：
1. 确认 /health 端点存在
2. 增加 startPeriod 时间
3. 检查应用是否正常启动
```

#### 错误：数据库连接失败
```
解决方案：
1. 检查 MYSQL_HOST 等环境变量
2. 确认数据库服务可访问
3. 检查网络连接
```

### 最佳实践

1. **资源请求要保守**
   - 初始请求应该是最小可用资源
   - 让 Kubernetes 根据实际使用自动扩容

2. **健康检查要合理**
   - 启动时间要足够长（至少 60 秒）
   - 检查间隔不要太频繁（30 秒）

3. **监控和日志**
   - 定期查看应用日志
   - 监控资源使用情况
   - 设置告警规则

### 联系支持

如果问题仍未解决：
1. 在 Zeabur 控制台提交工单
2. 提供详细的错误日志
3. 说明已尝试的解决方案

